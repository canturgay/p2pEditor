import{a0 as U,r as u,a1 as $,a2 as r,a3 as t}from"./index-CplbzeJY.js";import{g as y}from"./vueGun-C29lUgCS.js";const P=U("auth",()=>{const n=u(""),g=u(""),c=u(!1),v=u(null),h=u(null),p=$(),s=y.user();s.recall({sessionStorage:!0}),s.is?.pub&&(s.get("alias").once(e=>{typeof e=="string"&&(n.value=e)}),c.value=!0),y.on("auth",e=>{e.ok!==0&&(c.value=!0,v.value=e,r.create({type:"positive",message:`Successfully signed in. Welcome back ${e.put?.alias}!`}),t.hide(),p.push("/home").catch(a=>{console.error(a)}))});function m(){t.show({message:"Signing in..."}),s.auth(n.value,g.value,e=>{e.err&&(t.hide(),r.create({type:"negative",message:`Sign in error: ${e.err}`}),console.error("Sign in error:",e.err))})}function b(){h.value=null,t.show({message:"Signing up..."}),y.get("~@"+n.value).once(e=>{if(e){t.hide(),r.create({type:"negative",message:"Alias already exists. Please choose another."});return}s.create(n.value,g.value,a=>{a.err?(t.hide(),r.create({type:"negative",message:`Sign up error: ${a.err}`}),console.error("Sign up error:",a.err)):m()})})}function w(){s.leave(),c.value=!1,v.value=null,n.value="",g.value="",p.push("/").catch(e=>{console.error(e)}),r.create({type:"info",message:"Logged out."})}function R(){if(!c.value){r.create({type:"negative",message:"You must be signed in to generate a recovery file."});return}const e=s._?.sea||v.value?.sea;if(!e){r.create({type:"negative",message:"Could not locate key-pair on the user object."});return}const a={alias:n.value,keys:e},l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=URL.createObjectURL(l),o=document.createElement("a");o.href=i,o.download=`${n.value}_recovery.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}function L(e,a,l){if(!e){r.create({type:"negative",message:"Please select a recovery file."});return}t.show({message:"Recovering accountâ€¦"});try{const i=JSON.parse(e),o=i.alias,d=i.keys;if(!o||!d)throw new Error("Missing alias or keys in recovery file");if(a&&a.length>0){a!==o&&r.create({type:"warning",message:"Provided alias does not match alias stored in recovery file. Proceeding with file alias."});const f=d;s.auth(f,S=>{S.err&&(t.hide(),r.create({type:"negative",message:`Recovery error: ${S.err}`}))});return}if(l&&l.length>0){s.auth(o,l,f=>{f.err&&(t.hide(),r.create({type:"negative",message:`Recovery error: ${f.err}`}))});return}t.hide(),r.create({type:"negative",message:"Please provide either your username OR your passphrase to recover your account."})}catch(i){console.error(i),t.hide(),r.create({type:"negative",message:"Invalid recovery file."})}}return{alias:n,pass:g,signIn:m,signUp:b,logout:w,isAuthenticated:c,ackData:v,signUpError:h,user:s,downloadRecoveryFile:R,recoverLogin:L}});export{P as u};
