import{u as ee,a as te,b as ne,c as ae,d as le,e as ie,f as M,h as oe,g as ue,i as se,Q as W}from"./format-CIoEm-z8.js";import{Q as re,g as ce}from"./vueGun-C29lUgCS.js";import{g as U,r as N,a as S,O as de,P as T,R as fe,h as I,c as Y,S as me,T as ve,U as ge,V as pe,o as J,b as be,W as ye,e as he,p as Fe,X as xe,B as Se,Y as Ce,w as Ve,C as Pe,D as _e,E as K,F as k,Z as ze,I as R,_ as Ae,$ as X,Q}from"./index-CplbzeJY.js";import{Q as Ie}from"./QPage-Bah8tRqZ.js";import{u as je}from"./AuthStore-SSvRpeL-.js";function D(e,d,y,F){const o=[];return e.forEach(r=>{F(r)===!0?o.push(r):d.push({failedPropValidation:y,file:r})}),o}function O(e){e?.dataTransfer&&(e.dataTransfer.dropEffect="copy"),T(e)}const ke={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ne=["rejected"];function qe({editable:e,dnd:d,getFileInput:y,addFilesToQueue:F}){const{props:o,emit:r,proxy:f}=U(),h=N(null),C=S(()=>o.accept!==void 0?o.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),_=S(()=>parseInt(o.maxFiles,10)),z=S(()=>parseInt(o.maxTotalSize,10));function V(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target?.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&de(t);else{const i=y();i!==t.target&&i?.click(t)}}function v(t){e.value&&t&&F(null,t)}function n(t,i,m,p){let l=Array.from(i||t.target.files);const b=[],A=()=>{b.length!==0&&r("rejected",b)};if(o.accept!==void 0&&C.value.indexOf("*/")===-1&&(l=D(l,b,"accept",s=>C.value.some(g=>s.type.toUpperCase().startsWith(g)||s.name.toUpperCase().endsWith(g))),l.length===0))return A();if(o.maxFileSize!==void 0){const s=parseInt(o.maxFileSize,10);if(l=D(l,b,"max-file-size",g=>g.size<=s),l.length===0)return A()}if(o.multiple!==!0&&l.length!==0&&(l=[l[0]]),l.forEach(s=>{s.__key=s.webkitRelativePath+s.lastModified+s.name+s.size}),p===!0){const s=m.map(g=>g.__key);l=D(l,b,"duplicate",g=>s.includes(g.__key)===!1)}if(l.length===0)return A();if(o.maxTotalSize!==void 0){let s=p===!0?m.reduce((g,w)=>g+w.size,0):0;if(l=D(l,b,"max-total-size",g=>(s+=g.size,s<=z.value)),l.length===0)return A()}if(typeof o.filter=="function"){const s=o.filter(l);l=D(l,b,"filter",g=>s.includes(g))}if(o.maxFiles!==void 0){let s=p===!0?m.length:0;if(l=D(l,b,"max-files",()=>(s++,s<=_.value)),l.length===0)return A()}if(A(),l.length!==0)return l}function c(t){O(t),d.value!==!0&&(d.value=!0)}function u(t){T(t),(t.relatedTarget!==null||fe.is.safari!==!0?t.relatedTarget!==h.value:document.elementsFromPoint(t.clientX,t.clientY).includes(h.value)===!1)===!0&&(d.value=!1)}function j(t){O(t);const i=t.dataTransfer.files;i.length!==0&&F(null,i),d.value=!1}function q(t){if(d.value===!0)return I("div",{ref:h,class:`q-${t}__dnd absolute-full`,onDragenter:O,onDragover:O,onDragleave:u,onDrop:j})}return Object.assign(f,{pickFiles:V,addFiles:v}),{pickFiles:V,addFiles:v,onDragover:c,onDragleave:u,processFiles:n,getDndNode:q,maxFilesNumber:_,maxTotalSizeNumber:z}}const De=Y({name:"QFile",inheritAttrs:!1,props:{...ne,...te,...ke,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ee,...Ne],setup(e,{slots:d,emit:y,attrs:F}){const{proxy:o}=U(),r=ae(),f=N(null),h=N(!1),C=le(e),{pickFiles:_,onDragover:z,onDragleave:V,processFiles:v,getDndNode:n}=qe({editable:r.editable,dnd:h,getFileInput:$,addFilesToQueue:L}),c=ie(e),u=S(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),j=S(()=>M(u.value)),q=S(()=>u.value.map(a=>a.name).join(", ")),t=S(()=>oe(u.value.reduce((a,x)=>a+x.size,0))),i=S(()=>({totalSize:t.value,filesNumber:u.value.length,maxFiles:e.maxFiles})),m=S(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:C.value,...F,id:r.targetUid.value,disabled:r.editable.value!==!0})),p=S(()=>"q-file q-field--auto-height"+(h.value===!0?" q-file--dnd":"")),l=S(()=>e.multiple===!0&&e.append===!0);function b(a){const x=u.value.slice();x.splice(a,1),s(x)}function A(a){const x=u.value.indexOf(a);x!==-1&&b(x)}function s(a){y("update:modelValue",e.multiple===!0?a:a[0])}function g(a){a.keyCode===13&&ve(a)}function w(a){(a.keyCode===13||a.keyCode===32)&&_(a)}function $(){return f.value}function L(a,x){const P=v(a,x,u.value,l.value),B=$();B!=null&&(B.value=""),P!==void 0&&((e.multiple===!0?e.modelValue&&P.every(H=>u.value.includes(H)):e.modelValue===P[0])||s(l.value===!0?u.value.concat(P):P))}function E(){return[I("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function Z(){if(d.file!==void 0)return u.value.length===0?E():u.value.map((x,P)=>d.file({index:P,file:x,ref:this}));if(d.selected!==void 0)return u.value.length===0?E():d.selected({files:u.value,ref:this});if(e.useChips===!0)return u.value.length===0?E():u.value.map((x,P)=>I(re,{key:"file-"+P,removable:r.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{b(P)}},()=>I("span",{class:"ellipsis",textContent:x.name})));const a=e.displayValue!==void 0?e.displayValue:q.value;return a.length!==0?[I("div",{class:e.inputClass,style:e.inputStyle,textContent:a})]:E()}function G(){const a={ref:f,...m.value,...c.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:L};return e.multiple===!0&&(a.multiple=!0),I("input",a)}return Object.assign(r,{fieldClass:p,emitValue:s,hasValue:j,inputRef:f,innerValue:u,floatingLabel:S(()=>j.value===!0||M(e.displayValue)),computedCounter:S(()=>{if(e.counterLabel!==void 0)return e.counterLabel(i.value);const a=e.maxFiles;return`${u.value.length}${a!==void 0?" / "+a:""} (${t.value})`}),getControlChild:()=>n("file"),getControl:()=>{const a={ref:r.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return r.editable.value===!0&&Object.assign(a,{onDragover:z,onDragleave:V,onKeydown:g,onKeyup:w}),I("div",a,[G()].concat(Z()))}}),Object.assign(o,{removeAtIndex:b,removeFile:A,getNativeElement:()=>f.value}),me(o,"nativeEl",()=>f.value),ue(r)}}),Ee=Y({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:d,emit:y}){const F=U(),o=N(null);let r=0;const f=[];function h(n){const c=typeof n=="boolean"?n:e.noErrorFocus!==!0,u=++r,j=(i,m)=>{y(`validation${i===!0?"Success":"Error"}`,m)},q=i=>{const m=i.validate();return typeof m.then=="function"?m.then(p=>({valid:p,comp:i}),p=>({valid:!1,comp:i,err:p})):Promise.resolve({valid:m,comp:i})};return(e.greedy===!0?Promise.all(f.map(q)).then(i=>i.filter(m=>m.valid!==!0)):f.reduce((i,m)=>i.then(()=>q(m).then(p=>{if(p.valid===!1)return Promise.reject(p)})),Promise.resolve()).catch(i=>[i])).then(i=>{if(i===void 0||i.length===0)return u===r&&j(!0),!0;if(u===r){const{comp:m,err:p}=i[0];if(p!==void 0&&console.error(p),j(!1,m),c===!0){const l=i.find(({comp:b})=>typeof b.focus=="function"&&ye(b.$)===!1);l!==void 0&&l.comp.focus()}}return!1})}function C(){r++,f.forEach(n=>{typeof n.resetValidation=="function"&&n.resetValidation()})}function _(n){n!==void 0&&T(n);const c=r+1;h().then(u=>{c===r&&u===!0&&(e.onSubmit!==void 0?y("submit",n):n?.target!==void 0&&typeof n.target.submit=="function"&&n.target.submit())})}function z(n){n!==void 0&&T(n),y("reset"),he(()=>{C(),e.autofocus===!0&&e.noResetFocus!==!0&&V()})}function V(){se(()=>{if(o.value===null)return;(o.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(o.value.querySelectorAll("[tabindex]"),c=>c.tabIndex!==-1))?.focus({preventScroll:!0})})}Fe(xe,{bindComponent(n){f.push(n)},unbindComponent(n){const c=f.indexOf(n);c!==-1&&f.splice(c,1)}});let v=!1;return ge(()=>{v=!0}),pe(()=>{v===!0&&e.autofocus===!0&&V()}),J(()=>{e.autofocus===!0&&V()}),Object.assign(F.proxy,{validate:h,resetValidation:C,submit:_,reset:z,focus:V,getValidationComponents:()=>f}),()=>I("form",{class:"q-form",ref:o,onSubmit:_,onReset:z},be(d.default))}}),Re={class:"row justify-between q-gutter-sm"},Ue=Se({__name:"AuthPage",setup(e){const d=je(),{alias:y,pass:F}=Ce(d),{signIn:o,signUp:r,recoverLogin:f}=d,h=N(null),C=N(null);Ve(h,v=>{if(!v){C.value=null;return}const n=new FileReader;n.onload=c=>{C.value=c.target?.result??null},n.readAsText(v)});function _(){f(C.value,y.value,F.value)}const z=N([]),V=ce.get("chat");return J(()=>{V.map().once((v,n)=>{v&&v.text&&z.value.push({id:n,from:v.from??"anon",text:v.text})})}),(v,n)=>(_e(),Pe(Ie,{class:"q-pa-md flex flex-center column"},{default:K(()=>[k(Ee,{onSubmit:ze(R(o),["prevent"]),class:"q-gutter-md",style:{width:"320px"}},{default:K(()=>[k(W,{modelValue:R(y),"onUpdate:modelValue":n[0]||(n[0]=c=>X(y)?y.value=c:null),label:"Username",outlined:"",dense:"","data-cy":"input-username"},null,8,["modelValue"]),k(W,{modelValue:R(F),"onUpdate:modelValue":n[1]||(n[1]=c=>X(F)?F.value=c:null),label:"Passphrase",type:"password",outlined:"",dense:"","data-cy":"input-pass"},null,8,["modelValue"]),k(De,{modelValue:h.value,"onUpdate:modelValue":n[2]||(n[2]=c=>h.value=c),label:"Recovery File (JSON)",outlined:"",dense:"",accept:"application/json","data-cy":"input-recovery-file"},null,8,["modelValue"]),Ae("div",Re,[k(Q,{label:"Sign In",color:"primary",type:"submit","no-caps":"",class:"col","data-cy":"btn-signin"}),k(Q,{label:"Sign Up",color:"secondary",onClick:R(r),"no-caps":"",class:"col","data-cy":"btn-signup"},null,8,["onClick"]),k(Q,{label:"Recover",color:"positive",onClick:_,"no-caps":"",class:"col",disable:!h.value,"data-cy":"btn-recover"},null,8,["disable"])])]),_:1},8,["onSubmit"])]),_:1}))}});export{Ue as default};
